%Copyright (C) 2010, shiv Shankar Dayal
%This file is part of Learn Correct programming.

%This book is free document. All conditions of GNU FDL are applicable.

%YOu should have received a copy of the GNU FDL 
%along with this software.  If not, see <http://www.gnu.org/licenses/>.
%Disclaimer: Any damage or loss of data because of programs given in this
%will bear no responsibility to author under any circumstances.

%interface=en --mode=screen
\usemodule[simplefonts,vim,mathml,database]
\setmainfont[Latin Modern Roman]
\setsansfont[Latin Modern Roman]
\setmonofont[Latin Modern Mono]
\setmathfont[]
\setupsimplefonts[size=10pt]
\setupindenting[yes,medium,next]
\unprotect
\definepapersize
  [manual]
  [\c!width=25cm,
   \c!height=25cm]

\definepapersize
  [screen]
  [\c!width=25cm,
   \c!height=25cm]

\setuppapersize
  [manual]
  [screen]
\defineframedtext
  [framedcode]
  [strut=yes,
   color=red,
   offset=3mm,
   width=20cm,
   align=flushleft]

\definetyping[code][numbering=line,
                    bodyfont=small,
                    color=red,
                    before={\startframedcode},
                    after={\stopframedcode}]
%toc
\setupcolors[state=start]
% turn off numbering of some levels
\setuphead[subsection]
\setuphead[subsubsection]
% TOC
% level=4, \subsubsubsections are not listed in TOC
% alternative=c, space to the page number is filled with dots
\setupcombinedlist[content][level=4,alternative=c,interaction=all,color=blue]
\setuplist[chapter][width=7mm]
\setuplist[section][width=10mm]
\setuplist[subsection][width=12mm]
% pagestyle=normal for changing the appearance of pagenumber
\setuplist[subsubsection][width=15mm]
%toc end
%pdf bookmarks
\startallmodes[screen]

\setupinteractionscreen[option=bookmark]
%pdf bookmarks end
%for cross-references
\def\myref[#1:#2]{%
  \expandafter\ifx\csname in#1\endcsname\relax
    \writestatus{warning}{referenceformat in#1 not defined}%
    \in[#1:#2]%
  \else
    \csname in#1\endcsname[#1:#2]%
  \fi}
\protect

\definevimtyping[CPP][syntax=cpp, numbering=on]
\definevimtyping[ASM][syntax=asm, numbering=on]
\preloadtypescripts

%\definetypeface[mainfacenormal]  [rm][serif] [modern]       [default]
%\definetypeface[mainfacenormal]  [ss][sans][modern]    [default]
%\definetypeface[mainfacenormal]  [tt][mono] [modern]      [default]
%\definetypeface[mainfacenormal]  [mm][math] [modern]       [default]

%\definetypeface[mainfacemedium]  [rm][serif] [modern][default]
%\definetypeface[mainfacenormal]  [ss][sans][modern]    [default]
%\definetypeface[mainfacemedium]  [tt][mono] [modern]      [default]
%\definetypeface[mainfacemedium]  [mm][math] [modern][default]

%\definetypeface[mainfacenarrowtt][tt][mono] [modern] [default]

%\setupbodyfont[mainfacenormal,11pt]

\definehead
  [remark]
  [subsubsubject]

\setuphead [chapter]      [color=green]
\setuphead [section]      [color=green]
\setuphead [subsection]   [color=green]
\setuphead [subsubsection][color=green]

\setupheadertexts
  []

\setupcolors
  [state=start]
\setupurl[state=start,color=blue]
\setuptyping
  [color=orchid,
]%   style=\mainfacenarrowtt]

\definetyping[functioncall]

\setuptype
  [color=orchid,
]%   style=\mainfacenarrowtt]

\definecolor[blue] [b=.5]
\definecolor[red]  [r=.5]
\definecolor[green][g=.5]
\definecolor[orchid][g=.3,b=.3]

\startsetups pagenumber:right
  \setlayerframed
    [page]
    [preset=rightbottom,offset=1cm]
    [frame=off,height=1cm,offset=overlay]
    {\useMPgraphic{luanumber}}
  \setlayerframed
    [page]
    [preset=rightbottom,offset=1cm,x=1.5cm]
    [frame=off,height=1cm,width=1cm,offset=overlay]
    {\pagenumber}
  \setlayerframed
    [page]
    [preset=rightbottom,offset=1cm,x=2.5cm]
    [frame=off,height=1cm,offset=overlay]
    {\getmarking[chapter]}% Lua\TeX\ Reference Manual}
\stopsetups

\startsetups pagenumber:left
  \setlayerframed
    [page]
    [preset=leftbottom,offset=1cm,x=2.5cm]
    [frame=off,height=1cm,offset=overlay]
    {\getmarking[chapter]}
  \setlayerframed
    [page]
    [preset=leftbottom,offset=1cm,x=1.5cm]
    [frame=off,height=1cm,width=1cm,offset=overlay]
    {\pagenumber}
  \setlayerframed
    [page]
    [preset=leftbottom,offset=1cm]
    [frame=off,height=1cm,offset=overlay]
    {\useMPgraphic{luanumber}}
\stopsetups

\setupitemize
  [color=orchid]

\setupinteraction
  [state=start,
   focus=standard, 
   color=all,
   contrastcolor=]

\placebookmarks
  [chapter,section,subsection,subsubsection,title,tableofcontents][chapter,section,subsection,subsubsection,title,tableofcontents]
\setuplist
  [chapter,section,subsection,subsubsection,table,figure]
   [level=4,alternative=c,interaction=all,color=blue]

% Hans doesn't like the bookmarks opening by default
% \setupinteractionscreen[option=bookmark]

\appendtoks\let\luatex\firstofoneargument\to\simplifiedcommands
\def\myin[#1:#2]{%
  \expandafter\ifx\csname in#1\endcsname\relax
    \writestatus{warning}{referenceformat in#1 not defined}%
    \in[#1:#2]%
  \else
    \csname in#1\endcsname[#1:#2]%
  \fi}
\starttext
%Hans's setup for headers
\setuppagenumbering[state=start,alternative=doublesided]

\setupheadertexts[]
\setupheadertexts[\setups{text a}][][][\setups{text b}]

\startsetups[text a]
  \rlap{\pagenumber}
  \hfill
  \getmarking[chapter]
  \hfill
  \llap{}
\stopsetups

\startsetups[text b]
  \rlap{}
  \hfill
  \getmarking[section]
  \hfill
  \llap{\pagenumber}
\stopsetups
\startfrontmatter
\startstandardmakeup
\startalignment[center]
  \vfill \definedfont[SerifBold at 48pt]\setstrut \strut Learning Correct   
  \definedfont[SerifBold at 48pt]\setstrut \strut Programming
  \blank[2*big] \definedfont[Serif at 30pt]\setstrut \strut C
  \blank[3*big] \definedfont[Serif at 36pt]\setstrut \strut Shiv S Dayal
  \vfill
\stopalignment
\stopstandardmakeup
\pagebreak
\startstandardmakeup
\startalignment[center]
\vfill
\definedfont[Serif at 16pt]\setstrut \strut Dedicated to my family and
  Free Software Community. 
\vfill
\stopalignment
\stopstandardmakeup
\pagebreak
\startstandardmakeup
\vfill
Copyright \copyright Shiv Shankar Dayal.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2 or
any later version published by the Free Software Foundation. The GNU
FDL is there in the same directory as this file with
name \quotation{LICENSE}.
\stopstandardmakeup
\completecontent
\completelistoftables
\completelistoffigures
\stopfrontmatter
\input{Preface.tex}
%\part{C}
\startstandardmakeup
\startalignment[center]
  \vfill
	\definedfont[Serif at 48pt]\setstrut \strut Part I
	\blank[3*big]
	\definedfont[Serif at 48pt]\setstrut \strut C 
  \vfill
\stopalignment
\stopstandardmakeup
\input{introduction.tex}
\input{fs.tex}
\input{env.tex}
\input{language.tex}
\startbackmatter
\completeindex[interaction=all]
\stopbackmatter
\stoptext
